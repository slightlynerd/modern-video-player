<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Modern Video Player</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>

  <div id="movie-player">
    <video id="video" width="100%" height="400" controls poster="bear.png">
      <source src="https://res.cloudinary.com/codehacks/video/upload/v1550059883/movie.mp4" type="video/mp4">
      Your browser does not support the video tag.
      <object width="100%" height="400" data="https://res.cloudinary.com/codehacks/video/upload/v1550059883/movie.mp4"></object>
    </video>
    <ul id="controls">
      <li><button id="vol-minus" type="button">Vol-</button></li>
      <li><button id="vol-plus" type="button">Vol+</button></li>
      <li><button id="skip-back" type="button">Rewind</button></li>
      <li><button id="toggle-play" type="button">Play/Pause</button></li>
      <li><button id="skip-forward" type="button">Fast Forward</button></li>
      <li><button id="fullscreen" type="button">Fullscreen</button></li>
      <li class="progress">
        <progress id="progress" value="0" min="0"></progress>
      </li>
    </ul>
  </div>

  <script>

    function playPauseVideo() {
      // pause or play video
      if (video.paused || video.ended) video.play();
      else video.pause();
    }

    function launchFullscreenMode() {
      const moviePlayer = document.getElementById('movie-player');

      // check if already in fullscreen
      const isFullScreen = function() {
        return !!(document.fullScreen || document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement || document.fullscreenElement);
      }

      if (isFullScreen()) {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
        else if (document.webkitCancelFullScreen) document.webkitCancelFullScreen();
        else if (document.msExitFullscreen) document.msExitFullscreen();
        // setFullscreenData(false);
      }
      else {
        if (moviePlayer.requestFullscreen) moviePlayer.requestFullscreen();
        else if (moviePlayer.mozRequestFullScreen) moviePlayer.mozRequestFullScreen();
        else if (moviePlayer.webkitRequestFullScreen) moviePlayer.webkitRequestFullScreen();
        else if (moviePlayer.msRequestFullscreen) moviePlayer.msRequestFullscreen();
        // setFullscreenData(true);
      }
    }

    function toggleVolume(arg) {
      // get inner text from the button
      const btn = arg.target;

      // get integer volume of the button
      const currentVolume = Math.floor(video.volume * 10) / 10;

      // determine the button clicked
      if (btn.innerText === 'Vol+') {
        if (currentVolume < 1) video.volume += 0.1;
      }
      else if (btn.innerText === 'Vol-') {
        if (currentVolume > 0) video.volume -= 0.1;
      }
    }

    function skip(arg) {
      const btn = arg.target;

      if (btn.innerText === 'Fast Forward'.trim()) {
        return video.currentTime += 5;
      }
      else {
        return video.currentTime -= 3;
      }
    }

    function setupVideoControls() {
      // get UI controls
      const volPlus = document.getElementById('vol-plus');
      const volMinus = document.getElementById('vol-minus');
      const rewind = document.getElementById('skip-back');
      const togglePlayBtn = document.getElementById('toggle-play');
      const forward = document.getElementById('skip-forward');
      const fullscreenBtn = document.getElementById('fullscreen');
      const controls = document.getElementById('controls');
      const progressBar = document.getElementById('progress');

      // hide default controls/show custom controls
      video.controls = false;
      controls.style.display = 'flex';

      togglePlayBtn.addEventListener('click', playPauseVideo);
      volPlus.addEventListener('click', toggleVolume);
      volMinus.addEventListener('click', toggleVolume);
      rewind.addEventListener('click', skip);
      forward.addEventListener('click', skip);

      // set max attribute for progress bar
      video.addEventListener('loadedmetadata', () => {
        progressBar.setAttribute('max', video.duration);
      });

      // update the progress bar as the video progresses
      video.addEventListener('timeupdate', () => {
        if (!progressBar.getAttribute('max')) progressBar.setAttribute('max', video.duration);
        progressBar.value = video.currentTime;
      });

      // detect for fullscreen mode support
      const fullScreenEnabled = !!(document.fullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled || document.webkitSupportsFullscreen || document.webkitFullscreenEnabled || document.createElement('video').webkitRequestFullScreen);

      // don't show button if fullscreen mode is not supported
      if (!fullScreenEnabled) {
        fullscreen.style.display = 'none';
      }
      else {
        fullscreenBtn.addEventListener('click', launchFullscreenMode);
      }
    }

    const video = document.getElementById('video');

    // check if browser supports HTML5 video
    const supportsMediaAPI = !!document.createElement('video').canPlayType;
    if (supportsMediaAPI) {
      // setup controls
      setupVideoControls();
    }
    
    if ('mediaSession' in navigator) {
      navigator.mediaSession.metadata = new MediaMetadata({
        title: 'Brown Bear',
        artist: 'Steve Anthony',
        album: 'Bears',
        artwork: [
          {
            src: 'bear.png',
            sizes: '96x96',
            type: 'image/png'
          }
        ]
      });
    }
    // const play = document.getElementById('toggle-play');
    // play.addEventListener('click', () => {
    //   video.play().then(_ => {
    //     navigator.mediaSession.setActionHandler('play', () => {
    //       video.play();
    //     });
    //   }).catch(err => console.log(err));
    // });
  </script>
  
</body>
</html>